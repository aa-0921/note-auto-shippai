// createAndPublishPaidArticle.js
// 有料記事を作成して自動投稿するスクリプト

import { runWithCore } from '@aa-0921/note-auto-core';

// アフィリエイト設定とリンクを別ファイルから読み込み
import { affiliateConfig, affiliateLinks } from './affiliateConfig.js';

// 記事内容配列（A）を読み込み
import articleContents from './articleContents.js';

// 再エクスポート（他のファイルから参照できるように）
export { affiliateConfig, affiliateLinks };

(async () => {
  await runWithCore(async ({ core, wantsBackground }) => {
    // このスクリプトだけ異なるAIモデルを使用する
    core.aiGenerator.models.article = 'tngtech/deepseek-r1t2-chimera:free';
    core.aiGenerator.models.rewrite = 'tngtech/deepseek-r1t2-chimera:free';
    core.aiGenerator.models.tags = 'tngtech/deepseek-r1t2-chimera:free';
    console.log('使用するAIモデル:', core.aiGenerator.models);

    // アカウント固有の題材・切り口（ここで管理）
    // 女性向け婚活テクニック関連の高品質な記事トピック
    const topics = [
      '30代女性が3ヶ月で理想の相手と出会えた婚活テクニック',
      'マッチングアプリで返信率90%を実現したプロフィール作成術',
      '初デートで好印象を与える会話術と絶対にNGな行動',
      '婚活パーティーで必ず声をかけられる女性の特徴と習慣',
      '年収500万円以上の男性と出会う婚活戦略と出会いの場',
      '婚活疲れを感じた時に試したい5つのリセット方法',
      '30代独身女性が結婚できた具体的な行動リスト30選',
      'マッチングアプリで既読スルーされないメッセージ術',
      '婚活サイトでプロフィール閲覧数を3倍にする写真選び',
      '婚活で失敗しない！男性の本音と裏の顔の見分け方',
      '婚活で成功する女性の共通点と習慣10選',
      '婚活で時間を無駄にしない！効率的な出会いの見つけ方',
      '婚活でモテる女性になるための5つの習慣とマインドセット',
      '婚活で失敗しない！男性との会話で避けるべき話題とNGワード',
      '婚活で成功する女性が実践している自己投資の方法',
      '婚活で理想の相手と出会うための行動計画とスケジュール',
      '婚活で疲れた時に試したいリフレッシュ方法と心の整え方',
      'マッチングアプリでマッチング数を3倍にする写真の撮り方',
      '婚活パーティーで話しかけられる女性になるための準備',
      '婚活で成功する女性が実践している自己分析の方法',
      'マッチングアプリで好印象を与える第一声の送り方',
      '婚活で失敗しない！男性が本気で結婚を考えている人の見分け方',
      '婚活で成功する女性が実践している自己プロデュース術',
      '婚活で理想の相手と出会うための出会いの場の選び方',
      '婚活で成功する女性が実践している自己投資の方法',
      '婚活で理想の相手と出会うための行動計画とスケジュール',
      '婚活で疲れた時に試したいリフレッシュ方法と心の整え方',
      'マッチングアプリでマッチング数を3倍にする写真の撮り方',
      '婚活パーティーで話しかけられる女性になるための準備',
      '婚活で成功する女性が実践している自己分析の方法',
      // 追加：クリックしたくなるキーワード（女性向け婚活）
      '婚活で「いい人」に巡り合えない本当の理由',
      'マッチングアプリで好かれる写真と嫌われる写真の違い',
      '初デートで「また会いたい」と思わせる会話の流れ',
      '婚活パーティーで声をかけられやすい服装と雰囲気',
      '年収・学歴より見られている男性の本音',
      '婚活疲れでやる気が出ない時の切り替え方',
      '既読スルーされた時の挽回メッセージ例',
      'お見合い・婚活パーティーで好印象を残す挨拶',
      '「結婚したい」が伝わるプロフィールの書き方',
      '30代・40代で婚活を始める時の心構え',
      '婚活で失敗しない相手の見極めポイント',
      'デート後に連絡が来ない時の対処法',
      '再婚婚活で気をつけることとアピールポイント',
      '婚活サイトとマッチングアプリの使い分け',
      '「いい人すぎる」と言われた時の改善策',
      '婚活で理想の相手に近づく自己投資',
      '第一印象で損しない話し方・表情',
      '婚活で断られない誘い方・デートの申し出方',
      '本気の男性と遊びの男性の見分け方',
      '婚活がうまくいく女性の共通する習慣',
    ];

    // 記事の切り口・構成のパターン
    // 女性向け婚活テクニック記事に適した構成パターン
    const patterns = [
      '読者の悩みや課題から入る構成',
      'この方法で実現できることを最初に示す構成',
      '実績や成果を具体的な数字で見せる構成',
      'ステップバイステップで手順を解説する構成',
      '失敗談から学ぶ実体験ベースの構成',
      '成功事例を複数紹介して再現性を示す構成',
      'Before/Afterで変化を明確に示す構成',
      'チェックリスト形式で実践しやすくする構成',
      'Q&A形式で読者の疑問に答える構成',
      'ストーリーテリングで共感を生む構成',
      '比較・対比で選択肢を明確にする構成',
      'よくある間違いを指摘して正解を示す構成',
      '時系列で成長過程を追う構成',
      '読者の感情に訴えかけるストーリー構成',
      '実践的なワークシートやテンプレートを提供する構成',
      '読者の目標達成までのロードマップを示す構成',
      '読者の不安を先回りして解消する構成',
      '短期的な成果と長期的な価値を両方示す構成',
      '読者がすぐに行動できる具体的なアクションを提示する構成',
      '共感できる悩みから入り、解決策を提示する構成',
      '実体験や成功事例を交えて説得力を持たせる構成',
      '具体的な数字や成果を示して信頼性を高める構成',
      '初心者にもわかりやすくかみ砕いて説明する構成',
      '読者の状況に寄り添って語りかける構成',
      '導入・本編・まとめの流れで整理して伝える構成',
      // 追加：思わずクリックしたくなる見出しパターン
      '【いい人に巡り合えない】本当の理由',
      '【好かれる写真vs嫌われる写真】違いと対策',
      '【また会いたい】と思わせる初デート会話術',
      '【声をかけられやすい】服装と雰囲気',
      '【年収より見てる】男性の本音',
      '【婚活疲れ】やる気が出ない時の切り替え',
      '【既読スルー挽回】メッセージ例',
      '【好印象を残す】挨拶と第一印象',
      '【結婚したいが伝わる】プロフィールの書き方',
      '【30代・40代】婚活を始める心構え',
      '【失敗しない】相手の見極めポイント',
      '【連絡が来ない時】デート後の対処法',
      '【再婚婚活】気をつけることとアピール',
      '【サイトとアプリ】婚活の使い分け',
      '【いい人すぎる】と言われた時の改善策',
      '【理想の相手に近づく】自己投資',
      '【第一印象で損しない】話し方・表情',
      '【断られない】誘い方・デートの申し出方',
      '【本気vs遊び】男性の見分け方',
      '【婚活がうまくいく】女性の共通習慣',
      // クリックしたくなる「〇〇な理由」系
      '【男性が離れる】本当の理由',
      '【婚活が続かない】意外な3つの理由',
      '【マッチングしても会えない】よくある理由',
      '【既読スルーされる】女性に共通する理由',
      '【プロポーズされない】男性心理の本当の理由',
      '【デートに発展しない】メッセージで損してる理由',
      '【婚活がうまくいかない】40代女性に多い理由',
      '【連絡が途切れる】男性が離れていく理由',
      '【好意が伝わらない】アピールが届かない理由',
      '【第二印象で冷める】男性が引いてしまう理由',
      '【婚活が長引く】気づいていない3つの理由',
      '【いい人ばかり出会う】本命に巡り合えない理由',
      '【断られがち】誘いが通らない本当の理由',
      '【写真で損してる】マッチング率が上がらない理由',
      '【長続きしない】恋愛が3ヶ月で終わる理由',
      '【既婚者にモテる】未婚の彼が来ない不思議な理由',
      '【返信が遅くなる】男性が冷めていく理由',
      // 〇〇が気になってクリックしたくなる系（読者は〇〇の正体を知りたくなる）
      '【〇〇が秘訣】婚活がうまくいく女性の共通点',
      '【〇〇が重要】好印象を残す第一印象で差がつく',
      '【〇〇を避けることの大切さ】婚活で失敗しないために',
      '【〇〇が秘訣】本命に巡り合う人がやっていること',
      '【〇〇が重要】デートに誘われやすいプロフィール',
      '【〇〇を避けることの大切さ】既読スルーされないために',
      '【〇〇が秘訣】長続きする恋愛の始め方',
      '【〇〇が重要】男性が本気で見るポイント',
      '【〇〇を避けることの大切さ】デート後に連絡が途切れないために',
      '【〇〇が秘訣】40代から婚活がうまくいく人',
      '【〇〇が重要】初回メッセージで好印象を残す',
      '【〇〇を避けることの大切さ】婚活疲れを防ぐ心がけ',
      '【〇〇が秘訣】断られない誘い方・デートの申し出方',
      '【〇〇が重要】マッチング率を上げる写真選び',
      '【〇〇を避けることの大切さ】相手に「重い」と思われないために',
      '【〇〇が秘訣】既読スルーを挽回するメッセージ術',
      '【〇〇が重要】プロポーズにつながる関係の築き方',
      '【〇〇を避けることの大切さ】本気でない男性を寄せつけないために',
      '【〇〇が秘訣】婚活パーティーで好印象を残す',
      '【〇〇が重要】結婚相談所選びで後悔しないポイント',
      '【〇〇を避けることの大切さ】プロフィールで損しないために',
      '【〇〇が秘訣】再婚婚活がうまくいく人',
      '【〇〇が重要】デート後の連絡のタイミング',
      '【〇〇を避けることの大切さ】「いい人すぎる」と言われないために',
      '【〇〇が秘訣】マッチングアプリで会いに至る流れ',
      '【〇〇が重要】相手の本気度を見極める会話',
      '【〇〇を避けることの大切さ】第二印象で冷められないために',
      '【〇〇が秘訣】理想の相手に近づく自己投資',
      '【〇〇が重要】初デートで「また会いたい」と思わせる',
      '【〇〇を避けることの大切さ】婚活が長引かないために',
      '【〇〇が秘訣】30代・40代が婚活を始める心構え',
      '【〇〇が重要】結婚したいが伝わるプロフィールの書き方',
      '【〇〇を避けることの大切さ】連絡が途切れないために',
      '【〇〇が秘訣】サイトとアプリの婚活使い分け',
      '【〇〇が重要】第一印象で損しない話し方・表情',
      '【〇〇を避けることの大切さ】好意が伝わらないまま終わらないために',
    ];

    const rewriteConditionsLines = [
      'あなたは婚活・恋愛の専門家で、女性向けの婚活テクニックに詳しいアドバイザーです。',
      '指定の見出し本文が短いため、200文字以上になるよう実体験や具体例、実践的なアドバイスを交えて厚くリライトしてください。',
      '読者は婚活中の女性で、理想の相手と出会いたい、婚活を成功させたいと考えている人です。',
      '難しい専門用語はできるだけ避け、噛み砕いた説明で安心感を与えてください。',
      '【注意】',
      '- タイトルや見出しは出力せず、本文のみを返す。',
      '- メタ情報（追加要素や文字数など）は一切出力しない。',
      '- 丁寧な敬語（です・ます）で、読みやすさ重視。',
      '- 絵文字を多めに、各行に1つ程度。',
      '- 元の内容に沿い、noteのMarkdownのみ使用。',
      '- 箇条書きは「・ 」、番号付きリストは使わない。',
      '- 特殊トークンや制御文字（<|begin_of_sentence|>等）は絶対に出力しない。',
      '- 自然で読みやすい日本語のみを出力する。',
      '- 完成した文章のみを返し、システムメッセージや処理情報は含めない。',
      '- 日本語の文章の中に英単語を混ぜないでください。すべて日本語で表現してください。',
      '- 【重要】絵文字を使用する場合は句読点（。や、）は付けないでください。句読点と絵文字を同時に使うことは禁止です。絵文字を使う場合は句読点は不要です。',
    ];

    // LLM用システムプロンプト（女性向け婚活テクニック記事用）
    const systemMessage =
      'あなたは婚活・恋愛の専門家で、日本語のnote記事編集者です。女性向けの婚活テクニックに関する、有料記事として価値のある構成と濃さで記事を作成してください。' +
      '【最重要】記事は必ず「## 有料セクション」の見出しを含め、その後に5000文字程度の詳細な内容を最後まで完全に生成してください。途中で生成を止めてはいけません。';

    // 記事生成プロンプト条件（有料記事用の構造を含む）
    const articleConditionsLines = [
      '【最重要】記事は必ず以下の4つの見出しを含めて、最後まで完全に生成してください：',
      '1. ## はじめに',
      '2. ## 有料記事部分のご紹介',
      '3. ## 有料部分の内容について',
      '4. ## 有料セクション',
      '',
      '【最重要】「## 有料セクション」の見出しの後に、必ず5000文字程度の詳細な内容を書いてください。',
      '記事が途中で終わってはいけません。「## 有料セクション」の内容を最後まで完全に生成してください。',
      '',
      'タイトル、本文、ハッシュタグ（#から始まるもの）を含めてください。',
      'タイトルは1行目に「# [実際のタイトル] | 婚活 | 恋愛 | マッチングアプリ | 結婚 | 出会い」として記載してください。',
      '「# タイトル」という文字列ではなく、実際の記事タイトルを入れてください。',
      'タイトルや本文には、できるだけ「婚活」「恋愛」「マッチングアプリ」「結婚」「出会い」「デート」などのキーワードを自然な形で盛り込んでください。',
      '本文にはタイトルを含めないでください。',
      '',
      '【記事の構造】以下の順序で必ず作成してください：',
      '',
      '## はじめに',
      '導入部分（無料で読める部分、500文字程度）',
      '   ・ 読者の興味を引く導入',
      '   ・ 記事の概要や背景',
      '   ・ 読者が共感できる悩みや不安',
      '',
      '## 有料記事部分のご紹介',
      '有料記事部分のメリット案内（200文字程度）',
      '   ・ 有料セクションで読める記事内容の価値やメリットのみを記載',
      '   ・ 記事の内容以外のサービス（スクリーンショット、ショートカット一覧、サポート体制など）は絶対に記載しない',
      '   ・ 記事コンテンツで得られる知識やノウハウのみを説明する',
      '',
      '## 有料部分の内容について',
      '有料部分でどんな記事内容が読めるのかを読者に伝えるセクションです。',
      '   ・ 箇条書き（「・ 」）で3〜7個程度、記事内のトピックを並べてください。',
      '   ・ 各項目は1〜2文で簡潔に、でも具体的に記述してください。',
      '   ・ 「誰向けか」「どんな変化・成果が期待できるか」も含めてください。',
      '   ・ ここはあくまで有料部分の"目次・要約"であり、本文そのものではありません。',
      '   ・ 【重要】記事の内容のみを記載し、記事以外のサービス（スクリーンショット、ショートカット一覧、サポート体制、質問し放題など）は絶対に記載しないでください。',
      '',
      '## 有料セクション',
      '【重要】このセクションは5000文字程度の詳細な内容を必ず書いてください。',
      '   ・ 具体的で実践的な内容',
      '   ・ 読者が求める深い情報やノウハウ',
      '   ・ 見出し（### サブ見出し）や箇条書きを交えて丁寧にまとめてください',
      '   ・ ステップバイステップの手順や長期的な視点を含めてください',
      '   ・ 実体験や具体例を豊富に含めてください',
      '   ・ 読者がすぐに実践できる具体的なテクニックやノウハウを提供してください',
      '   ・ 婚活で成功するためのマインドセットや考え方も含めてください',
      '   ・ このセクションを最後まで完全に生成してください。途中で終わってはいけません。',
      '',
      '【最終確認】記事には必ず以下の4つの見出しが順番通りに含まれていることを確認してください：',
      '1. ## はじめに',
      '2. ## 有料記事部分のご紹介',
      '3. ## 有料部分の内容について',
      '4. ## 有料セクション（この後に5000文字程度の詳細な内容を必ず書く）',
      '',
      'ハッシュタグは記事末尾に「#〇〇 #〇〇 ...」の形式でまとめてください。',
      'あなたは婚活・恋愛の専門家で、プロの編集者です。',
      '読みやすさを重視してください。',
      '可能であればランキング形式やステップ形式を取り入れてください。',
      '改行を多めに入れてください。',
      '各行に1つ程度、絵文字を使用してください。',
      'すべて日本語で出力してください。',
      '切り口に沿った内容にしてください。',
      '女性読者に寄り添う温かみのある文章を心がけてください。',
      '実体験や成功事例を交えて、読者が「自分にもできそう」と思える内容にしてください。',
      'noteの正しいマークダウン記法のみを使ってください。',
      '箇条書きはマークダウンではなく、「・ 」で表現してください。',
      '見出しはh2（## 見出し）・h3（### 見出し）のみ。',
      '見出しに「**」等は使わないでください。',
      '番号付きリストは使わないでください。',
      'h1（# タイトル）はタイトル行のみで本文中では使わないでください。',
      'その他のマークダウンやHTMLタグは使わないでください。',
      '【重要】特殊トークンや制御文字（<|begin_of_sentence|>、<|end_of_sentence|>等）は絶対に出力しないでください。',
      '【重要】自然で読みやすい日本語のみを出力し、システムメッセージや処理情報は一切含めないでください。',
      '【重要】完成した記事のみを返してください。',
      '【重要】日本語の文章の中に英単語を混ぜないでください。すべて日本語で表現してください。',
      '【重要】絵文字を使用する場合は句読点（。や、）は付けないでください。句読点と絵文字を同時に使うことは禁止です。絵文字を使う場合は句読点は不要です。例：「誰でも始められる不労所得の選択肢が広がります🌐」のように、絵文字の前後に句読点を付けないでください。',
      '',
      '【禁止事項】記事の提供以外のサービスを保証するような内容は絶対に記載しないでください。',
      '   ・ スクリーンショットの提供',
      '   ・ ショートカット一覧の提供',
      '   ・ サポート体制や質問し放題のサービス',
      '   ・ 記事以外の特典や追加サービス',
      '   ・ 上記のような内容を暗示する表現も使用しないでください。',
      '',
      '【最終確認】記事には必ず「## 有料部分の内容について」と「## 有料セクション」という見出しが含まれていることを確認してください。',
      'これらの見出しが含まれていない記事は無効です。',
    ];

    // タグ生成の指示文（参考実装：固定タグの必須含有を要求）
    const tagsInstruction =
      '記事内容から最も関連する日本語タグを3〜5個生成し、半角スペース区切りで出力してください。必ず「#婚活 #恋愛 #結婚 #マッチングアプリ #引き寄せの法則」を含めてください。本文や説明は禁止。';

    // タイトル装飾用絵文字（参考実装のセット）
    const titleEmojis = [
      '❤️',
      '🌸',
      '🛑',
      '㊙︎',
      '🟥',
      '🈲',
      '🉐',
      '㊗️',
      '㊙️',
      '⭕',
      '‼️',
      '🎉',
    ];

    // ----------------------------------------------------------------------------------

    // 有料記事設定（AI稼ぎ方.mdの価格帯に寄せる）
    const paidEnabled = true; // 有料記事にするか
    // 価格をランダムに選択（AI稼ぎ方.mdを参考にした価格帯）
    const priceOptions = [980, 1980];
    // const priceOptions = [3980];
    const price = priceOptions[Math.floor(Math.random() * priceOptions.length)];
    console.log(`選択された価格: ${price}円`);

    // 記事内容配列（A）が存在するかチェック
    const articleContentsArray = Array.isArray(articleContents) && articleContents.length > 0
      ? articleContents
      : undefined;

    // 記事の自動生成と有料記事としての投稿機能を実行
    await core.runCreateAndPublishPaidArticle({
      background: wantsBackground,
      // 記事内容配列（A）が存在する場合はそれを渡す（存在しない場合は topics と patterns を使用）
      articleContents: articleContentsArray,
      topics,
      patterns,
      paidEnabled,
      price,
      systemMessage,
      articleConditionsLines,
      rewriteConditionsLines,
      tagsInstruction,
      titleEmojis,
      // 有料記事ではアフィリエイトリンク、おすすめ記事セクションは不要（core側で無効化）
      affiliateLinks: [],
      magazinePromotion: [],
      amazonAssociateText: '',
      // おすすめ記事セクション設定（有料記事では不要）
      recommendedArticlesTitle: '',
      recommendedArticlesUrls: [],
      // 有料記事用の設定
      maxTokens: 12000, // 長い記事を生成するため
      paidMode: true, // 有料記事モードを有効化
      paidRewriteHeading: '有料部分の内容について', // このセクションのみリライト
    });
    console.log('有料記事の自動生成と投稿が完了しました');
  });
})();
